<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
    content="填写必要信息即可实时预览 A4 模板，支持证件照裁剪、模板切换与 PDF 导出的简历生成器。" />
  <title>简历生成器</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css" />
</head>

<body>
  <header class="hero">
    <div class="hero__halo" aria-hidden="true">
      <div class="hero__glow hero__glow--one"></div>
      <div class="hero__glow hero__glow--two"></div>
    </div>
    <div class="hero__content">
      <p class="eyebrow">Resume Lab</p>
      <h1>简历生成器</h1>
      <p class="muted">填写必要信息后即可实时查看 A4 预览，支持证件照裁剪与多模板导出 PDF。</p>
      <div class="hero__actions">
        <button class="btn" type="button" data-scroll="#resume-form">开始填写</button>
        <button class="btn btn-ghost" type="button" data-action="download">下载 PDF</button>
      </div>
    </div>
    <div class="hero__decor" aria-hidden="true">
      <span class="hero__pill hero__pill--primary">实时预览</span>
      <span class="hero__pill hero__pill--secondary">证件照裁剪</span>
      <span class="hero__pill hero__pill--tertiary">PDF 导出</span>
      <span class="hero__pill hero__pill--quaternary">AI 辅助</span>
      <span class="hero__pill hero__pill--quinary">云端同步</span>
      <span class="hero__pill hero__pill--senary">智能排版</span>
      <span class="hero__pill hero__pill--septenary">模板库</span>
    </div>
  </header>

  <main class="stack stack--vertical">
    <section class="panel panel--form">
      <h2 class="panel__title">填写关键信息</h2>
      <p class="muted">字段均为规范简历中需要展示的内容，请保持精简。</p>
      <form id="resume-form" class="form" autocomplete="off">
        <div class="form__group">
          <label><span>姓名</span><input id="fullName" type="text" placeholder="例如：李可欣" /></label>
          <label><span>应聘职位</span><input id="targetRole" type="text" placeholder="投行分析师 / 产品经理" /></label>
          <label><span>手机号</span><input id="phone" type="text" placeholder="138-0000-0000" /></label>
          <label><span>邮箱</span><input id="email" type="email" placeholder="contact@yourmail.com" /></label>
          <label><span>所在城市</span><input id="location" type="text" placeholder="上海" /></label>
          <label><span>出生年月</span><input id="birth" type="text" placeholder="1997.03" /></label>
          <label><span>最高学历 / 院校</span><input id="degree" type="text" placeholder="复旦大学 · 金融硕士" /></label>
          <label><span>政治面貌 / 身份</span><input id="affiliation" type="text" placeholder="中共党员" /></label>
          <label><span>个人主页（选填）</span><input id="website" type="text" placeholder="linkedin.com/in/you" /></label>
          <label><span>GPA（选填）</span><input id="gpa" type="text" placeholder="GPA 3.8 / 4.0" /></label>
          <label><span>证件照链接（选填）</span><input id="photoUrl" type="text"
              placeholder="https://example.com/photo.jpg" /></label>
          <label><span>上传证件照</span><input id="photoFile" type="file" accept="image/*" /></label>
        </div>

        <label class="form__block">
          <span>个人简介（建议 3 句：背景 | 核心能力 | 关键成果）</span>
          <textarea id="summary" rows="3" placeholder="3 句概述：行业资历 / 能力亮点 / 业务成绩"></textarea>
        </label>

        <label class="form__block">
          <span>工作 / 实习经历（每行：时间 | 公司 | 职位 | 量化成果）</span>
          <textarea id="experience" rows="6" placeholder="2023.03-至今 | XX证券 | ECM 分析师 | 负责 IPO 项目 4 单"></textarea>
        </label>

        <label class="form__block">
          <span>教育背景（每行：时间 | 学校 | 专业 | 成绩）</span>
          <textarea id="education" rows="4" placeholder="2019.09-2021.06 | 复旦大学 | 金融硕士 | GPA 3.8/4.0"></textarea>
        </label>

        <label class="form__block">
          <span>技能 / 证书（每行一项）</span>
          <textarea id="skills" rows="4" placeholder="财务建模 / Excel VBA"></textarea>
        </label>

        <label class="form__block">
          <span>荣誉 / 奖项（每行：年份 | 奖项 | 等级）</span>
          <textarea id="awards" rows="4" placeholder="2022 | CFA Level II | PASS"></textarea>
        </label>
      </form>
    </section>

    <section class="panel panel--preview">
      <div class="panel__header">
        <div>
          <h2 class="panel__title">一页 A4 预览</h2>
          <p class="muted">实时同步填写内容，可切换不同模板</p>
        </div>
        <button class="btn btn-ghost" type="button" data-action="download">下载 PDF</button>
      </div>

      <fieldset class="form__block">
        <legend>模板切换</legend>
        <div class="template-picker">
          <label class="template-picker__option">
            <input type="radio" name="template" value="classic" checked />
            <span>经典常规</span>
          </label>
          <label class="template-picker__option">
            <input type="radio" name="template" value="minimal" />
            <span>极简留白</span>
          </label>
          <label class="template-picker__option">
            <input type="radio" name="template" value="sidebar" />
            <span>双色侧栏</span>
          </label>
        </div>
      </fieldset>

      <div class="preview-wrapper">
        <article id="previewSheet" class="sheet sheet--classic" aria-live="polite">
          <header class="sheet__header">
            <div>
              <h2 class="sheet__name" id="previewName"></h2>
              <p class="sheet__role" id="previewRole"></p>
              <p class="sheet__meta" id="previewMeta"></p>
              <ul class="sheet__contact-list" id="previewContact"></ul>
            </div>
            <div class="sheet__photo">
              <img id="previewPhoto" alt="证件照预览" />
            </div>
          </header>
          <div class="sheet__body">
            <section class="sheet__section">
              <h3>个人简介</h3>
              <p id="previewSummary"></p>
            </section>

            <section class="sheet__section">
              <h3>工作 / 实习经历</h3>
              <ul id="previewExperience" class="sheet__list"></ul>
            </section>

            <section class="sheet__section">
              <h3>教育背景</h3>
              <ul id="previewEducation" class="sheet__list"></ul>
            </section>

            <section class="sheet__section">
              <h3>技能 / 证书</h3>
              <ul id="previewSkills" class="sheet__list sheet__list--inline"></ul>
            </section>

            <section class="sheet__section">
              <h3>荣誉 / 奖项</h3>
              <ul id="previewAwards" class="sheet__list"></ul>
            </section>
          </div>
        </article>
      </div>
    </section>
  </main>

  <section id="cropModal" class="modal" hidden>
    <div class="modal__content">
      <h3>裁剪证件照</h3>
      <p class="muted">拖拽调整裁剪框，保持 3:4 比例并保留足够留白。</p>
      <div class="cropper-wrapper">
        <img id="cropImage" alt="上传的证件照" />
      </div>
      <div class="modal__actions">
        <button type="button" class="btn btn-ghost" data-action="crop-cancel">取消</button>
        <button type="button" class="btn" data-action="crop-confirm">应用裁剪</button>
      </div>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>
  <script src="scripts/html2pdf.bundle.min.js"></script>
  <script>
    function initResumeLab() {
      const defaults = {
        fullName: '李可欣',
        targetRole: '投行分析师',
        phone: '138-0000-0000',
        email: 'kexin.li@example.com',
        location: '上海',
        birth: '1997.03',
        degree: '复旦大学 · 金融硕士',
        affiliation: '中共党员',
        website: 'linkedin.com/in/kexinli',
        gpa: 'GPA 3.8 / 4.0',
        summary: '4 年 ECM 项目经验，熟悉 IPO / 债券承销流程，擅长财务建模与多团队协作，落地 3 个上市项目。',
        experience: '2023.03-至今 | XX证券 | ECM 分析师 | 负责 3 单 IPO 执行，搭建收益测算模型，协调律师及审计；\n2021.07-2023.02 | 远见资本 | 投资分析师 | 跟进 12 个消费赛道项目，完成 6 份投资备忘录。',
        education: '2019.09-2021.06 | 复旦大学 | 金融硕士 | GPA 3.8/4.0\n2015.09-2019.06 | 上海财经大学 | 经济学学士 | GPA 3.7/4.0',
        skills: '财务建模 / Excel VBA\nBloomberg 终端\nCFA 二级\n英语 IELTS 7.5',
        awards: '2022 | CFA Level II | PASS\n2020 | 全国大学生商业挑战赛 | 一等奖',
        photo: 'avatar.jpg'
      };

      const fields = {
        fullName: document.getElementById('fullName'),
        targetRole: document.getElementById('targetRole'),
        phone: document.getElementById('phone'),
        email: document.getElementById('email'),
        location: document.getElementById('location'),
        birth: document.getElementById('birth'),
        degree: document.getElementById('degree'),
        affiliation: document.getElementById('affiliation'),
        website: document.getElementById('website'),
        gpa: document.getElementById('gpa'),
        photoUrl: document.getElementById('photoUrl'),
        photoFile: document.getElementById('photoFile'),
        summary: document.getElementById('summary'),
        experience: document.getElementById('experience'),
        education: document.getElementById('education'),
        skills: document.getElementById('skills'),
        awards: document.getElementById('awards')
      };

      const preview = {
        sheet: document.getElementById('previewSheet'),
        name: document.getElementById('previewName'),
        role: document.getElementById('previewRole'),
        meta: document.getElementById('previewMeta'),
        contact: document.getElementById('previewContact'),
        photo: document.getElementById('previewPhoto'),
        summary: document.getElementById('previewSummary'),
        experience: document.getElementById('previewExperience'),
        education: document.getElementById('previewEducation'),
        skills: document.getElementById('previewSkills'),
        awards: document.getElementById('previewAwards')
      };

      const cropModal = document.getElementById('cropModal');
      const cropImage = document.getElementById('cropImage');
      const cropApply = document.querySelector('[data-action="crop-confirm"]');
      const cropCancel = document.querySelector('[data-action="crop-cancel"]');

      let cropper = null;
      let photoDataUrl = '';

      function ensureProtocol(url) {
        if (!url) return '';
        const trimmed = url.trim();
        if (!trimmed || /^(data:|blob:)/i.test(trimmed)) return trimmed;
        return /^https?:\/\//i.test(trimmed) ? trimmed : `https://${trimmed}`;
      }

      function splitLines(value) {
        return value
          .split(/\n+/)
          .map((line) => line.trim())
          .filter(Boolean);
      }

      function renderList(target, rows, inline = false) {
        target.innerHTML = '';
        rows.forEach((row) => {
          const li = document.createElement('li');
          if (inline) li.classList.add('sheet__pill');
          li.textContent = row;
          target.appendChild(li);
        });
      }

      function updatePreview() {
        const name = fields.fullName.value.trim() || defaults.fullName;
        const role = fields.targetRole.value.trim() || defaults.targetRole;
        const location = fields.location.value.trim() || defaults.location;
        const birth = fields.birth.value.trim() || defaults.birth;
        const degree = fields.degree.value.trim() || defaults.degree;
        const affiliation = fields.affiliation.value.trim() || defaults.affiliation;
        const website = fields.website.value.trim() || defaults.website;
        const gpa = fields.gpa.value.trim() || defaults.gpa;

        preview.name.textContent = name;
        preview.role.textContent = role;
        preview.meta.textContent = [location, birth, degree].filter(Boolean).join(' · ');

        const contacts = [
          { label: '电话', value: fields.phone.value.trim() || defaults.phone },
          { label: '邮箱', value: fields.email.value.trim() || defaults.email },
          { label: '网站', value: ensureProtocol(website) },
          { label: '身份', value: affiliation },
          { label: '成绩', value: gpa }
        ].filter(({ value }) => value);

        preview.contact.innerHTML = '';
        contacts.forEach(({ label, value }) => {
          const li = document.createElement('li');
          li.className = 'sheet__contact-item';
          li.innerHTML = `<span class="sheet__contact-label">${label}</span><span class="sheet__contact-value">${value}</span>`;
          preview.contact.appendChild(li);
        });

        const summary = fields.summary.value.trim() || defaults.summary;
        preview.summary.textContent = summary;

        renderList(preview.experience, splitLines(fields.experience.value || defaults.experience));
        renderList(preview.education, splitLines(fields.education.value || defaults.education));
        renderList(preview.skills, splitLines(fields.skills.value || defaults.skills), true);
        renderList(preview.awards, splitLines(fields.awards.value || defaults.awards));

        const customPhoto = photoDataUrl || ensureProtocol(fields.photoUrl.value);
        preview.photo.src = customPhoto || defaults.photo;
      }

      function handlePhotoUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          cropImage.src = reader.result;
          cropModal.hidden = false;
          cropper?.destroy();
          cropper = new Cropper(cropImage, {
            aspectRatio: 3 / 4,
            viewMode: 1,
            background: false,
            dragMode: 'move'
          });
        };
        reader.readAsDataURL(file);
      }

      function closeCropper() {
        cropModal.hidden = true;
        cropper?.destroy();
        cropper = null;
        fields.photoFile.value = '';
      }

      cropApply.addEventListener('click', () => {
        if (!cropper) return;
        const canvas = cropper.getCroppedCanvas({ width: 360, height: 480, imageSmoothingQuality: 'high' });
        photoDataUrl = canvas.toDataURL('image/jpeg', 0.92);
        closeCropper();
        updatePreview();
      });

      cropCancel.addEventListener('click', closeCropper);

      function createPrintableSheet() {
        const wrapper = document.createElement('div');
        wrapper.className = 'print-wrapper';
        const printable = preview.sheet.cloneNode(true);
        printable.classList.add('sheet--print');
        wrapper.appendChild(printable);
        document.body.appendChild(wrapper);
        return { wrapper, printable };
      }

      function downloadPDF() {
        const { wrapper, printable } = createPrintableSheet();
        html2pdf().set({
          margin: 0,
          filename: 'resume.pdf',
          image: { type: 'jpeg', quality: 0.95 },
          html2canvas: { scale: 2, useCORS: true, backgroundColor: '#ffffff' },
          jsPDF: { unit: 'px', format: [794, 1123], orientation: 'portrait' },
          pagebreak: { mode: ['avoid-all'] }
        }).from(printable).save().finally(() => wrapper.remove());
      }

      function initForm() {
        Object.entries(fields).forEach(([key, element]) => {
          if (element.type === 'file') {
            element.addEventListener('change', handlePhotoUpload);
            return;
          }
          if (defaults[key]) element.value = defaults[key];
          element.addEventListener('input', () => {
            if (key === 'photoUrl') photoDataUrl = '';
            updatePreview();
          });
        });
        document.getElementById('resume-form').addEventListener('submit', (evt) => evt.preventDefault());
      }

      function initTemplatePicker() {
        document.querySelectorAll('input[name="template"]').forEach((radio) => {
          radio.addEventListener('change', () => {
            preview.sheet.className = `sheet sheet--${radio.value}`;
          });
        });
      }

      function initActions() {
        document.querySelectorAll('[data-scroll]').forEach((btn) => {
          btn.addEventListener('click', () => {
            document.querySelector(btn.dataset.scroll)?.scrollIntoView({ behavior: 'smooth' });
          });
        });

        document.querySelectorAll('[data-action="download"]').forEach((btn) => {
          btn.addEventListener('click', downloadPDF);
        });
      }

      initForm();
      initTemplatePicker();
      initActions();
      updatePreview();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initResumeLab, { once: true });
    } else {
      initResumeLab();
    }
  </script>
</body>

</html>

